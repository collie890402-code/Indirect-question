<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indirect Question Master - ê°„ì ‘ì˜ë¬¸ë¬¸ í•™ìŠµ ê²Œì„</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼: Inter í°íŠ¸ ì‚¬ìš© ë° ì•± ë°°ê²½ ì„¤ì • */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* ë¼ì´íŠ¸ ëª¨ë“œ ê¸°ë³¸ ë°°ê²½ */
        }
        /* ë²„íŠ¼ í´ë¦­ í”¼ë“œë°± íš¨ê³¼ */
        .option-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .option-button {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-gray-50">

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div id="app" class="flex-grow container mx-auto p-4 sm:p-6 lg:p-10 max-w-4xl">

        <!-- í—¤ë” ì„¹ì…˜ -->
        <header class="text-center py-6 sm:py-8 mb-6 bg-white rounded-xl shadow-lg">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-blue-700">
                âœ¨ Indirect Question Master
            </h1>
            <p class="mt-2 text-md text-gray-600">
                ê³ ë“±í•™ìƒì„ ìœ„í•œ ê°„ì ‘ì˜ë¬¸ë¬¸ ì–´ìˆœ ë§ˆìŠ¤í„°! ì‹¤ìš©ì ì¸ ì˜ì–´ í•™ìŠµì„ ì‹œì‘í•˜ì„¸ìš”.
            </p>
        </header>

        <!-- í•™ìŠµ ì»¨í…ì¸  ì˜ì—­ -->
        <main class="space-y-8">

            <!-- 1. í€´ì¦ˆ ì„¹ì…˜: ì˜¬ë°”ë¥¸ ì–´ìˆœ ê³ ë¥´ê¸° (ì£¼ìš” í•™ìŠµ í™œë™) -->
            <section id="quiz-section" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold mb-5 text-gray-800 border-b pb-2 text-blue-600">
                    1ï¸âƒ£ ì–´ìˆœ í€´ì¦ˆ: ì˜¬ë°”ë¥¸ ì ˆì„ ê³¨ë¼ì£¼ì„¸ìš”
                </h2>
                
                <div id="quiz-container">
                    <!-- ì ìˆ˜ í‘œì‹œ -->
                    <p id="current-score" class="text-lg font-semibold text-right text-gray-500 mb-4">
                        ì •ë‹µë¥ : 0/0
                    </p>

                    <!-- ì§ˆë¬¸ ì¹´ë“œ (ë¹ˆì¹¸ ë¬¸ì¥ + Context) -->
                    <div class="bg-blue-50 p-5 rounded-lg border-l-4 border-blue-500 shadow-inner">
                        <!-- Context: Original Direct Question -->
                        <p id="context-direct-question" class="text-md text-gray-600 mb-3">
                            <!-- ì§ì ‘ ì˜ë¬¸ë¬¸ (Context) -->
                        </p>
                        <!-- Main Prompt: Sentence with Blank -->
                        <p id="sentence-with-blank" class="text-xl sm:text-2xl font-bold text-blue-800">
                            <!-- ì™„ì„±í•  ë¬¸ì¥: Do you know [        ]. -->
                        </p>
                    </div>

                    <!-- ì„ íƒì§€ ì»¨í…Œì´ë„ˆ -->
                    <div id="options-container" class="mt-6 space-y-3">
                        <!-- ì„ íƒì§€ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤. -->
                    </div>

                    <!-- í”¼ë“œë°± ë©”ì‹œì§€ -->
                    <div id="feedback-message" class="mt-6 p-4 rounded-lg text-center font-semibold transition-all duration-300 hidden">
                        <!-- í”¼ë“œë°± ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤. -->
                    </div>
                </div>
            </section>

            <!-- 2. ì‘ë¬¸ ì—°ìŠµ ì„¹ì…˜: ì†Œì…œ ë¯¸ë””ì–´ ì§ˆë¬¸ (ì‹¤ìš©ì  ì‘ë¬¸ ê³¼ì œ) -->
            <section id="writing-section" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold mb-5 text-gray-800 border-b pb-2 text-green-600">
                    2ï¸âƒ£ ì‘ë¬¸ ì—°ìŠµ: ì…€ëŸ½ì—ê²Œ ì§ˆë¬¸í•˜ê¸°
                </h2>
                <p class="text-sm text-gray-600 mb-4">
                    ì•„ë˜ ìƒí™©ì„ **ê°„ì ‘ì˜ë¬¸ë¬¸** í˜•íƒœë¡œ ì‘ì„±í•´ ë³´ì„¸ìš”. (ì˜ˆì‹œ: I wonder, I'd like to know ë“±ì„ í™œìš©)
                </p>

                <!-- ì‘ë¬¸ í”„ë¡¬í”„íŠ¸ -->
                <div id="writing-prompt" class="p-4 bg-yellow-50 rounded-md mb-4 text-yellow-800 font-medium border border-yellow-300">
                    <!-- ì‘ë¬¸ ê³¼ì œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤. -->
                </div>

                <label for="user-answer" class="block text-sm font-medium text-gray-700 mb-2">
                    ë‚˜ì˜ ê°„ì ‘ì˜ë¬¸ë¬¸ (ë¬¸ì¥ì˜ ëì€ ë§ˆì¹¨í‘œ '.'ë¡œ):
                </label>
                <textarea id="user-answer" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 text-gray-900" placeholder="ì˜ˆ: I wonder when she will release the album."></textarea>
                
                <button id="check-writing-btn" class="mt-4 w-full py-2 px-4 rounded-lg shadow-md text-white bg-green-500 hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150">
                    ì‘ë¬¸ í™•ì¸í•˜ê¸° & ë‹¤ìŒ ê³¼ì œ
                </button>
                
                <!-- ì‘ë¬¸ í”¼ë“œë°± -->
                <div id="writing-feedback" class="mt-4 p-4 rounded-lg text-sm text-gray-800 bg-gray-100 hidden">
                    <!-- ì‘ë¬¸ í”¼ë“œë°±ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤. -->
                </div>
            </section>
            
            <!-- 3. ì‹œë®¬ë ˆì´ì…˜ ëŒ€í™”: ì‹ë‹¹ ì˜ˆì•½ í™•ì¸í•˜ê¸° (ì‹¤ìš©ì  ë§¥ë½ ì´í•´) -->
            <section id="dialogue-section" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold mb-5 text-gray-800 border-b pb-2 text-purple-600">
                    3ï¸âƒ£ ì‹¤ìš© ëŒ€í™”: ì‹ë‹¹ ì˜ˆì•½ ì‹œë®¬ë ˆì´ì…˜
                </h2>
                <p class="text-sm text-gray-600 mb-4">
                    ì‹ë‹¹ ì˜ˆì•½ ìƒí™©ì—ì„œ ê°„ì ‘ì˜ë¬¸ë¬¸ì´ ì–´ë–»ê²Œ ì‚¬ìš©ë˜ëŠ”ì§€ ì‚´í´ë³´ë©° ì‹¤ìš©ì ì¸ ê°ê°ì„ ìµíˆì„¸ìš”.
                </p>

                <div class="space-y-4 max-w-lg mx-auto">
                    <!-- Dialogue 1 -->
                    <div class="flex justify-start">
                        <div class="bg-blue-100 p-3 rounded-xl rounded-bl-sm max-w-[80%] text-sm shadow-md">
                            **Customer:** Hello, I'd like to confirm my reservation. Could you tell me **what my reservation name is**?
                        </div>
                    </div>
                    <!-- Dialogue 2 -->
                    <div class="flex justify-end">
                        <div class="bg-gray-200 p-3 rounded-xl rounded-br-sm max-w-[80%] text-sm shadow-md">
                            **Restaurant:** Certainly. Your name is John Doe. May I ask **if you are aware of our new closing time**?
                        </div>
                    </div>
                    <!-- Dialogue 3 -->
                    <div class="flex justify-start">
                        <div class="bg-blue-100 p-3 rounded-xl rounded-bl-sm max-w-[80%] text-sm shadow-md">
                            **Customer:** Oh, I wasn't. I also wanted to check **how many people we can bring in total**.
                        </div>
                    </div>
                    <!-- Dialogue 4 -->
                    <div class="flex justify-end">
                        <div class="bg-gray-200 p-3 rounded-xl rounded-br-sm max-w-[80%] text-sm shadow-md">
                            **Restaurant:** Your party limit is four. Please confirm **what time you expect to arrive**.
                        </div>
                    </div>
                </div>
                <p class="mt-6 text-sm text-center text-purple-600 font-medium">
                    ğŸ‘‰ **í•™ìŠµ Tip:** êµµì€ ê¸€ì”¨ì˜ ê°„ì ‘ì˜ë¬¸ë¬¸ë“¤ì€ ëª¨ë‘ 'ì£¼ì–´ + ë™ì‚¬'ì˜ ì–´ìˆœì„ ì§€í‚¤ê³  ìˆìŠµë‹ˆë‹¤.
                </p>
            </section>

        </main>

    </div>

    <!-- JavaScript ë¡œì§ -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // =================================================================
            // 1. ìƒíƒœ ë° ë°ì´í„° ì •ì˜
            // =================================================================
            let currentQuestionIndex = 0;
            let score = 0;
            let totalQuestionsAnswered = 0;
            let currentWritingPromptIndex = 0;
            let isAnswerLocked = false; // ì˜¤ë‹µ ì‹œ ì¬í´ë¦­ ë°©ì§€

            // ê°„ì ‘ì˜ë¬¸ë¬¸ í•™ìŠµì„ ìœ„í•œ í€´ì¦ˆ ë°ì´í„° (1ë²ˆ ì„¹ì…˜)
            // í˜•ì‹: [ì§ì ‘ ì˜ë¬¸ë¬¸, ìœ ë„ ë¬¸êµ¬ (ì• ë¬¸ì¥), ì •ë‹µ ì„ íƒì§€ (ì ˆ), ì˜¤ë‹µ 1 (ì ˆ), ì˜¤ë‹µ 2 (ì ˆ), íŒíŠ¸]
            const quizData = [
                [
                    "Where does he live?",
                    "Do you know", // ìœ ë„ ë¬¸êµ¬ (ì• ë¬¸ì¥)
                    "where he lives.", 
                    "where does he live.", 
                    "does he live where.", 
                    "ê°„ì ‘ì˜ë¬¸ë¬¸ì€ 'ì˜ë¬¸ì‚¬ + ì£¼ì–´ + ë™ì‚¬' ì–´ìˆœì„ ë”°ë¥´ë©°, ì¡°ë™ì‚¬ 'do/does/did'ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
                ],
                [
                    "When will they arrive?",
                    "I wonder",
                    "when they will arrive.",
                    "when will they arrive.", 
                    "will they arrive when.", 
                    "'will'ì€ ì¡°ë™ì‚¬ì´ì§€ë§Œ, ê°„ì ‘ì˜ë¬¸ë¬¸ì—ì„œëŠ” ì£¼ì–´ ë’¤ì— ìœ„ì¹˜í•©ë‹ˆë‹¤. (ì£¼ì–´ + will + ë™ì‚¬ì›í˜•)"
                ],
                [
                    "Is the meeting postponed?",
                    "Could you tell me",
                    "if the meeting is postponed.", 
                    "if is the meeting postponed.", 
                    "the meeting is postponed if.", 
                    "Yes/No ì§ˆë¬¸ì¼ ë•ŒëŠ” 'if'ë‚˜ 'whether'ë¥¼ ì‚¬ìš©í•˜ê³ , ê·¸ ë’¤ì— 'ì£¼ì–´ + ë™ì‚¬' ì–´ìˆœì„ ì”ë‹ˆë‹¤."
                ],
                [
                    "Who broke the window?",
                    "She asked",
                    "who broke the window.",
                    "who did break the window.", 
                    "did who break the window.", 
                    "Whoê°€ ì£¼ì–´ ì—­í• ì„ í•  ë•ŒëŠ” ì–´ìˆœ ë³€í™” ì—†ì´ ê·¸ëŒ€ë¡œ ì”ë‹ˆë‹¤. (Who + ë™ì‚¬)"
                ],
                [
                    "What time did you wake up?",
                    "I forgot",
                    "what time you woke up.",
                    "what time did you wake up.", 
                    "did you wake up what time.", 
                    "ê³¼ê±°ì‹œì œ ì¡°ë™ì‚¬ 'did'ëŠ” ìƒëµí•˜ê³ , ë³¸ë™ì‚¬(wake)ë¥¼ ê³¼ê±°í˜•(woke)ìœ¼ë¡œ ë°”ê¿” ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤."
                ]
            ];
            
            // ì‹¤ìš©ì  ì‘ë¬¸ ì—°ìŠµ ê³¼ì œ (2ë²ˆ ì„¹ì…˜)
            // alternativeExampleì€ êµ¬ì¡°ëŠ” ìœ ì§€í•˜ë˜ ë‚´ìš©ì´ ì•½ê°„ ë‹¤ë¥¸ ì˜ˆì‹œë¥¼ ì œê³µí•©ë‹ˆë‹¤.
            const writingPrompts = [
                {
                    prompt: "ì†Œì…œ ë¯¸ë””ì–´ì—ì„œ ì¢‹ì•„í•˜ëŠ” ê°€ìˆ˜ì—ê²Œ 'ë‹¤ìŒ ì•¨ë²”ì€ ì–¸ì œ ë‚˜ì˜¬ì§€' ì§ˆë¬¸í•˜ê³  ì‹¶ì–´ìš”.",
                    alternativeExample: "I wonder if your new single will be out next month." // if/ì£¼ì–´+ë™ì‚¬ êµ¬ì¡° ìœ ì§€, ë‚´ìš© ë³€ê²½
                },
                {
                    prompt: "ë°°ìš°ì˜ ë¼ì´ë¸Œ ë°©ì†¡ì—ì„œ 'ê·¸ ì˜í™”ë¥¼ ì´¬ì˜í•˜ë©´ì„œ ê°€ì¥ ì–´ë ¤ì› ë˜ ì ì´ ë¬´ì—‡ì¸ì§€' ê¶ê¸ˆí•˜ë‹¤ê³  ë§í•˜ê³  ì‹¶ì–´ìš”.",
                    alternativeExample: "Could you tell me what inspired you the most during the project?" // ì˜ë¬¸ì‚¬+ë™ì‚¬ êµ¬ì¡° ìœ ì§€, ë‚´ìš© ë³€ê²½
                },
                {
                    prompt: "ì¸í”Œë£¨ì–¸ì„œì—ê²Œ 'ë‹¹ì‹ ì´ ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ì±…ì´ ë¬´ì—‡ì¸ì§€' ì•Œë ¤ë‹¬ë¼ê³  ìš”ì²­í•˜ê³  ì‹¶ì–´ìš”.",
                    alternativeExample: "I would love to know what genres you read the most." // ì˜ë¬¸ì‚¬+ì£¼ì–´+ë™ì‚¬ êµ¬ì¡° ìœ ì§€, ë‚´ìš© ë³€ê²½
                }
            ];

            // DOM ìš”ì†Œ ì„ íƒ
            const contextDirectQuestionEl = document.getElementById('context-direct-question');
            const sentenceWithBlankEl = document.getElementById('sentence-with-blank');
            const optionsContainer = document.getElementById('options-container');
            const feedbackMessageEl = document.getElementById('feedback-message');
            const currentScoreEl = document.getElementById('current-score');
            const writingPromptEl = document.getElementById('writing-prompt');
            const userAnsTextArea = document.getElementById('user-answer');
            const checkWritingBtn = document.getElementById('check-writing-btn');
            const writingFeedbackEl = document.getElementById('writing-feedback');

            // =================================================================
            // 2. í€´ì¦ˆ ë¡œì§ í•¨ìˆ˜
            // =================================================================

            /** ë°°ì—´ì˜ ìš”ì†Œ ìˆœì„œë¥¼ ë¬´ì‘ìœ„ë¡œ ì„ëŠ” í•¨ìˆ˜ */
            const shuffleArray = (array) => {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            };

            /** í˜„ì¬ ì¸ë±ìŠ¤ì˜ í€´ì¦ˆë¥¼ ë¡œë“œí•˜ê³  í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤. */
            const loadQuestion = () => {
                if (currentQuestionIndex >= quizData.length) {
                    displayFeedback(`ğŸ‰ í€´ì¦ˆ ë§ˆìŠ¤í„°! ëª¨ë“  í€´ì¦ˆ ì™„ë£Œ. ìµœì¢… ì •ë‹µë¥ : ${score}/${totalQuestionsAnswered}`, 'bg-green-100 text-green-700 border-green-500', false);
                    optionsContainer.innerHTML = `<p class="text-xl text-center text-gray-600 mt-4">ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤. í™”ë©´ì„ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”.</p>`;
                    return;
                }

                isAnswerLocked = false;
                feedbackMessageEl.classList.add('hidden');
                optionsContainer.innerHTML = '';

                const [directQ, introPhrase, correctAns, wrongAns1, wrongAns2] = quizData[currentQuestionIndex];
                
                // 1. Context: Original Direct Question
                contextDirectQuestionEl.innerHTML = `**ì§ì ‘ ì˜ë¬¸ë¬¸ (Context):** "${directQ}"`;
                
                // 2. New Prompt: Sentence with Blank (Emphasizing the clause role)
                sentenceWithBlankEl.innerHTML = `${introPhrase} <span class="text-red-500">[        ]</span>. <span class="text-base text-gray-700 font-normal block mt-2">ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ì˜¬ë°”ë¥¸ 'ê°„ì ‘ ì˜ë¬¸ë¬¸ ì ˆ'ì„ ê³ ë¥´ì„¸ìš”.</span>`;


                const options = [correctAns, wrongAns1, wrongAns2];
                shuffleArray(options);

                options.forEach(option => {
                    const button = document.createElement('button');
                    // ì˜µì…˜ ë‚´ìš©ì€ ê°„ì ‘ ì˜ë¬¸ë¬¸ 'ì ˆ' ìì²´ (ex: where he lives.)
                    button.textContent = option; 
                    button.className = 'option-button w-full py-3 px-4 text-left border border-gray-300 rounded-lg shadow-sm text-md font-medium text-gray-800 bg-white hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-500';
                    button.addEventListener('click', () => checkAnswer(button, option, correctAns));
                    optionsContainer.appendChild(button);
                });
            };

            /**
             * ì‚¬ìš©ìì˜ ë‹µë³€ì„ í™•ì¸í•˜ê³  í”¼ë“œë°±ì„ ì œê³µí•©ë‹ˆë‹¤. (ìš”êµ¬ì‚¬í•­: ì˜¤ë‹µì¸ ê²½ìš° íŒíŠ¸ë§Œ ì œê³µí•˜ê³  í•™ìŠµìê°€ ë¬¸ì¥ì„ ìˆ˜ì •í•˜ë„ë¡ í•¨)
             */
            const checkAnswer = (button, selectedAnswer, correctAnswer) => {
                if (isAnswerLocked) return;

                // ì •ë‹µ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ ì‹œë„ íšŸìˆ˜ ì¦ê°€
                totalQuestionsAnswered++;
                currentScoreEl.textContent = `ì •ë‹µë¥ : ${score}/${totalQuestionsAnswered}`;

                // ëª¨ë“  ë²„íŠ¼ì„ ë¹„í™œì„±í™”
                Array.from(optionsContainer.children).forEach(btn => btn.disabled = true);

                if (selectedAnswer === correctAnswer) {
                    score++;
                    button.classList.remove('bg-white', 'hover:bg-blue-100');
                    button.classList.add('bg-green-500', 'hover:bg-green-600', 'text-white', 'shadow-xl');
                    
                    currentScoreEl.textContent = `ì •ë‹µë¥ : ${score}/${totalQuestionsAnswered}`;
                    displayFeedback('âœ… ì •ë‹µì…ë‹ˆë‹¤! ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.', 'bg-green-100 text-green-700 border-green-500');
                    
                    // ì ì‹œ í›„ ë‹¤ìŒ ë¬¸ì œ ë¡œë“œ
                    setTimeout(() => {
                        currentQuestionIndex++;
                        loadQuestion();
                    }, 1500);

                } else {
                    // ì˜¤ë‹µ: íŒíŠ¸ ì œê³µ í›„ ì¬ë„ì „ ìœ ë„ (ì—¬ê¸°ì„œëŠ” íŒíŠ¸ ì œê³µ í›„ ë¬¸ì œë¥¼ ì´ˆê¸°í™”í•˜ì—¬ í•™ìŠµìê°€ ì¬ì‹œë„í•˜ê²Œ í•¨)
                    isAnswerLocked = true; // ì¬í´ë¦­ ë°©ì§€

                    button.classList.remove('bg-white', 'hover:bg-blue-100');
                    button.classList.add('bg-red-500', 'text-white');

                    // íŒíŠ¸ ì œê³µ
                    const hint = quizData[currentQuestionIndex][5];
                    displayFeedback(`âŒ ì˜¤ë‹µì…ë‹ˆë‹¤. íŒíŠ¸: ${hint}`, 'bg-red-100 text-red-700 border-red-500', 3000);

                    // ì ì‹œ í›„ í€´ì¦ˆ ì¬ë¡œë“œ (ë²„íŠ¼ ì¬í™œì„±í™” ë° ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”)
                    setTimeout(() => {
                        loadQuestion();
                    }, 3000);
                }
            };

            /**
             * í”¼ë“œë°± ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ê³  ì¼ì • ì‹œê°„ í›„ ìˆ¨ê¹ë‹ˆë‹¤.
             * @param {string} message - í‘œì‹œí•  ë©”ì‹œì§€
             * @param {string} classes - Tailwind CSS ë°°ê²½ ë° í…ìŠ¤íŠ¸ í´ë˜ìŠ¤
             * @param {number} duration - ë©”ì‹œì§€ë¥¼ í‘œì‹œí•  ì‹œê°„ (ms), 0ì´ë©´ ìˆ¨ê¸°ì§€ ì•ŠìŒ
             */
            const displayFeedback = (message, classes, duration = 1500) => {
                feedbackMessageEl.innerHTML = `<span class="border-b-2 ${classes.split(' ')[1].replace('text-', 'border-')} pb-1">${message}</span>`;
                // ì´ì „ í´ë˜ìŠ¤ë¥¼ ëª¨ë‘ ì œê±°í•˜ê³  ìƒˆë¡œìš´ í´ë˜ìŠ¤ ì ìš©
                feedbackMessageEl.className = `mt-6 p-4 rounded-lg text-center font-semibold transition-all duration-300 border ${classes}`;
                feedbackMessageEl.classList.remove('hidden');

                if (duration > 0) {
                    setTimeout(() => {
                        feedbackMessageEl.classList.add('hidden');
                    }, duration);
                }
            };

            // =================================================================
            // 3. ì‘ë¬¸ ì—°ìŠµ ë¡œì§ í•¨ìˆ˜
            // =================================================================

            /** í˜„ì¬ ì¸ë±ìŠ¤ì˜ ì‘ë¬¸ ê³¼ì œë¥¼ ë¡œë“œí•©ë‹ˆë‹¤. */
            const loadWritingPrompt = () => {
                userAnsTextArea.value = '';
                writingFeedbackEl.classList.add('hidden');

                if (currentWritingPromptIndex >= writingPrompts.length) {
                    writingPromptEl.textContent = "âœ… ëª¨ë“  ì‘ë¬¸ ê³¼ì œë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!";
                    userAnsTextArea.disabled = true;
                    checkWritingBtn.disabled = true;
                    checkWritingBtn.textContent = 'ì™„ë£Œ';
                    checkWritingBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    return;
                }

                writingPromptEl.textContent = writingPrompts[currentWritingPromptIndex].prompt;
                checkWritingBtn.textContent = 'ì‘ë¬¸ í™•ì¸í•˜ê¸° & ë‹¤ìŒ ê³¼ì œ';
                userAnsTextArea.disabled = false;
                checkWritingBtn.disabled = false;
            };

            /** ì‘ë¬¸ í™•ì¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬. */
            checkWritingBtn.addEventListener('click', () => {
                const userAnswer = userAnsTextArea.value.trim();
                const currentPrompt = writingPrompts[currentWritingPromptIndex];

                if (userAnswer.length < 10) {
                    writingFeedbackEl.innerHTML = 'âš ï¸ ë¬¸ì¥ì„ ì¶©ë¶„íˆ ê¸¸ê²Œ ì‘ì„±í•´ ì£¼ì„¸ìš”.';
                    writingFeedbackEl.className = 'mt-4 p-4 rounded-lg text-sm bg-red-100 text-red-700 border border-red-300';
                    writingFeedbackEl.classList.remove('hidden');
                    return;
                }

                // í”¼ë“œë°± êµ¬ì„±
                let feedbackText = `<p class="font-bold">ğŸ“ ë‚˜ì˜ ì‘ë¬¸: ${userAnswer}</p><br>`;
                
                // ê°„ì ‘ì˜ë¬¸ë¬¸ì˜ í•µì‹¬ ì–´ìˆœ(ì£¼ì–´+ë™ì‚¬) ê·œì¹™ì„ ê°•ì¡°í•˜ëŠ” í”¼ë“œë°± ì œê³µ
                const isProperlyPunctuated = userAnswer.endsWith('.');
                const hasIntroPhrase = userAnswer.toLowerCase().includes('i wonder') || 
                                       userAnswer.toLowerCase().includes('i\'d like to know') ||
                                       userAnswer.toLowerCase().includes('can you tell me') ||
                                       userAnswer.toLowerCase().includes('i would love to know') ||
                                       userAnswer.toLowerCase().includes('could you tell me');

                if (isProperlyPunctuated && hasIntroPhrase) {
                    feedbackText += '<p class="text-green-700 font-bold">ğŸ‘ í›Œë¥­í•©ë‹ˆë‹¤! ìœ ë„ ë¬¸êµ¬ì™€ ë§ˆì¹¨í‘œë¥¼ ì˜ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</p>';
                    feedbackText += '<p class="mt-2">ì´ì œ ë¬¸ì¥ ì¤‘ê°„ì˜ **"ì˜ë¬¸ì‚¬ + ì£¼ì–´ + ë™ì‚¬"** ì–´ìˆœì„ í™•ì¸í•´ ë³´ì„¸ìš”. ì¡°ë™ì‚¬(do/does/did)ê°€ ìˆë‹¤ë©´ ì œê±°í•˜ê³  ë³¸ë™ì‚¬ ì‹œì œë¥¼ ë§ì¶”ëŠ” ê²ƒë„ ì¤‘ìš”í•©ë‹ˆë‹¤.</p>';
                    writingFeedbackEl.className = 'mt-4 p-4 rounded-lg text-sm bg-green-100 text-gray-800 border border-green-300';

                } else {
                    feedbackText += '<p class="text-red-700 font-bold">ğŸ’¡ ìˆ˜ì • í•„ìš”: ê°„ì ‘ì˜ë¬¸ë¬¸ì€ ë¬¸ì¥ì˜ ì¼ë¶€ì´ë¯€ë¡œ, ì¼ë°˜ì ìœ¼ë¡œ ë§ˆì¹¨í‘œ(.)ë¡œ ëë‚©ë‹ˆë‹¤.</p>';
                    feedbackText += '<p class="mt-2">ë˜í•œ, "I wonder, I\'d like to know" ê°™ì€ ìœ ë„ ë¬¸êµ¬ë¥¼ ì‚¬ìš©í–ˆëŠ”ì§€ í™•ì¸í•´ ë³´ì„¸ìš”.</p>';
                    writingFeedbackEl.className = 'mt-4 p-4 rounded-lg text-sm bg-yellow-100 text-gray-800 border border-yellow-300';
                }

                // ë¬¸ì œì˜ ì •ë‹µ ëŒ€ì‹ , êµ¬ì¡°ëŠ” ê°™ì§€ë§Œ ë‚´ìš©ì´ ë‹¤ë¥¸ ëŒ€ì²´ ì˜ˆì‹œë¥¼ ì œê³µ
                feedbackText += `<br><p class="font-bold text-blue-600">â­ ì°¸ê³ í•  ë§Œí•œ ë‹¤ë¥¸ ì˜¬ë°”ë¥¸ ì˜ˆì‹œ: ${currentPrompt.alternativeExample}</p>`;
                
                writingFeedbackEl.innerHTML = feedbackText;
                writingFeedbackEl.classList.remove('hidden');

                // ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™
                currentWritingPromptIndex++;
                setTimeout(loadWritingPrompt, 4000); // 4ì´ˆ í›„ ë‹¤ìŒ ê³¼ì œ ë¡œë“œ
            });

            // =================================================================
            // 4. ì´ˆê¸°í™” ë° ì‹¤í–‰
            // =================================================================
            loadQuestion();
            loadWritingPrompt();

        });
    </script>
</body>
</html>